Agentic coding - OFF

---

como refactorizar este componete usando clean code en react usando custom hooks

---

Te ayudo a refactorizar este componente usando clean code y custom hooks. Primero voy a leer el archivo para entender mejor la estructura:

---

Ahora voy a crear los custom hooks necesarios para refactorizar este componente siguiendo principios de clean code:

---

Perfecto. Ahora voy a crear los custom hooks necesarios para refactorizar el componente:

## 1. Custom Hook para manejo de imágenes

---



Ahora voy a crear los custom hooks para refactorizar el componente siguiendo principios de clean code:

## 1. Custom Hook para manejo de imágenes

```typescript
// hooks/useImageUpload.ts
import { useState } from 'react';
import { useEdgeStore } from '../lib/edgestore';

export const useImageUpload = () => {
  const { edgestore } = useEdgeStore();
  const [image, setImage] = useState<File | null>(null);
  const [imagePreview, setImagePreview] = useState<string>('');
  const [uploadProgress, setUploadProgress] = useState<number>(0);

  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      setImage(file);
      setImagePreview(URL.createObjectURL(file));
    }
  };

  const removeImage = () => {
    setImage(null);
    setImagePreview('');
    setUploadProgress(0);
  };

  const uploadImage = async (): Promise<string | null> => {
    if (!image) return null;
    
    const response = await edgestore.PrivateFiles.upload({
      file: image,
      input: { type: 'private' },
      onProgressChange: setUploadProgress,
    });
    
    return response.url;
  };

  return {
    image,
    imagePreview,
    uploadProgress,
    handleImageChange,
    removeImage,
    uploadImage,
  };
};
```

## 2. Custom Hook para el formulario de crear post

```typescript
// hooks/useCreatePostForm.ts
import { useState } from 'react';
import { usePostMutation } from './use-postMutation';
import { useImageUpload } from './useImageUpload';

export const useCreatePostForm = () => {
  const [description, setDescription] = useState('');
  const { postMutation } = usePostMutation();
  const imageUpload = useImageUpload();

  const resetForm = () => {
    setDescription('');
    imageUpload.removeImage();
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!description.trim()) return;

    const imageUrl = await imageUpload.uploadImage();
    
    postMutation.mutate({ 
      description, 
      ...(imageUrl && { image: imageUrl }) 
    });

    resetForm();
  };

  const isSubmitDisabled = !description.trim() || postMutation.isPending;

  return {
    description,
    setDescription,
    handleSubmit,
    isSubmitDisabled,
    isLoading: postMutation.isPending,
    ...imageUpload,
  };
};
```

## 3. Componente refactorizado

```typescript
// components/CreatePost/CreatePost.tsx
import { useAuthContext } from '../../context/Auth.contex';
import { Image, X } from 'lucide-react';
import './CreatePost.scss';
import avatarPlaceholder from '../../assets/Avatar-Profile-Vector-PNG-Pic.png';
import { Progress } from './progress-loader/progress';
import { useCreatePostForm } from '../../hooks/useCreatePostForm';

export const CreatePost = () => {
  const { user } = useAuthContext();
  const {
    description,
    setDescription,
    handleSubmit,
    isSubmitDisabled,
    imagePreview,
    uploadProgress,
    handleImageChange,
    removeImage,
  } = useCreatePostForm();

  return (
    <div className='create-post'>
      <div className='create-post__header'>
        <img
          src={user?.profilePicture ?? avatarPlaceholder}
          alt='Profile'
          className='create-post__avatar'
        />
        <span className='create-post__username'>{user?.username}</span>
      </div>

      <form onSubmit={handleSubmit} className='create-post__form'>
        <textarea
          placeholder="What's on your mind?"
          value={description}
          onChange={e => setDescription(e.target.value)}
          className='create-post__textarea'
          rows={3}
        />
        
        {uploadProgress > 0 && <Progress progresWidt={uploadProgress} />}

        {imagePreview && (
          <div className='create-post__image-preview'>
            <img src={imagePreview} alt='Preview' />
            <button
              type='button'
              onClick={removeImage}
              className='create-post__remove-image'
            >
              <X size={20} />
            </button>
          </div>
        )}
        
        <div className='create-post__actions'>
          <label className='create-post__image-upload'>
            <Image size={20} />
            <span>Photo</span>
            <input type='file' accept='image/*' onChange={handleImageChange} hidden />
          </label>

          <button
            type='submit'
            className='create-post__submit'
            disabled={isSubmitDisabled}
          >
            post
          </button>
        </div>
      </form>
    </div>
  );
};
```

## Beneficios de la refactorización:

1. **Separación de responsabilidades**: Cada hook tiene una responsabilidad específica
2. **Reutilización**: Los hooks pueden ser reutilizados en otros componentes
3. **Testabilidad**: Es más fácil testear la lógica por separado
4. **Legibilidad**: El componente se enfoca solo en la presentación
5. **Mantenibilidad**: Cambios en la lógica no afectan la presentación

Los custom hooks encapsulan:
- `useImageUpload`: Manejo completo de imágenes (selección, preview, upload)
- `useCreatePostForm`: Lógica del formulario y coordinación entre hooks

El componente queda limpio y enfocado únicamente en la presentación.